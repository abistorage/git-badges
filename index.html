<title>Shiki</title>
<link rel="stylesheet" href="style.css">
<pre class="shiki" style="background-color: #0d1117"><code><span class="line"><span style="color: #8B949E">/// SPDX-License-Information: MIT</span></span>
<span class="line"><span style="color: #FF7B72">pragma</span><span style="color: #C9D1D9"> </span><span style="color: #7EE787">solidity</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">&gt;=0.5.0</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">&lt;</span><span style="color: #79C0FF">0.9</span><span style="color: #C9D1D9">.</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">pragma</span><span style="color: #C9D1D9"> </span><span style="color: #7EE787">experimental</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">&quot;ABIEncoderV2</span><span style="color: #C9D1D9">&quot;;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">/// </span><span style="color: #FF7B72">@author</span><span style="color: #8B949E"> https://github.com/Ohalo-Ltd/ethereum_contracts/tree/master/strings</span></span>
<span class="line"><span style="color: #8B949E">/// </span><span style="color: #FF7B72">@title</span><span style="color: #8B949E"> Validate UTF8 String Encoding</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">library</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">ValidateUTF8</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// Key bytes.</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// http://www.unicode.org/versions/Unicode10.0.0/UnicodeStandard-10.0.pdf</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// Table 3-7, p 126, Well-Formed UTF-8 Byte Sequences</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// Default 80..BF range</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> DL </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x80</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> DH </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xBF</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// Row - number of bytes</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// R1 - 1</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B11L </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x00</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B11H </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x7F</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// R2 - 2</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B21L </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xC2</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B21H </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xDF</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// R3 - 3</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B31 </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xE0</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B32L </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xA0</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B32H </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xBF</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// R4 - 3</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B41L </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xE1</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B41H </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xEC</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// R5 - 3</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B51 </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xED</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B52L </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x80</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B52H </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x9F</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// R6 - 3</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B61L </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xEE</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B61H </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xEF</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// R7 - 4</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B71 </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xF0</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B72L </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x90</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B72H </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xBF</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// R8 - 4</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B81L </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xF1</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B81H </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xF3</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// R9 - 4</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B91 </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xF4</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B92L </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x80</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">constant</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> B92H </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x8F</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// Checks if a string is valid UTF-8. The function reverts if the string is invalid.</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">validate</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">string</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">memory</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">self</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">pure</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> addr;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> len;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">assembly</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">            addr </span><span style="color: #FF7B72">:=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(self, </span><span style="color: #79C0FF">0x20</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">            len </span><span style="color: #FF7B72">:=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mload</span><span style="color: #C9D1D9">(self)</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (len </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> bytePos </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">while</span><span style="color: #C9D1D9"> (bytePos </span><span style="color: #FF7B72">&lt;</span><span style="color: #C9D1D9"> len) {</span></span>
<span class="line"><span style="color: #C9D1D9">            bytePos </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseRune</span><span style="color: #C9D1D9">(addr </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> bytePos);</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">assert</span><span style="color: #C9D1D9">(bytePos </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> len);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// Parses a single character, or &quot;rune&quot; stored at address &#39;bytePos&#39; in memory.</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// Returns the length of the character in bytes.</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// </span><span style="color: #FF7B72">solhint-disable</span><span style="color: #8B949E">-next-line code-complexity</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">parseRune</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">bytePos</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">internal</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">pure</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">returns</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">len</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> val;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">assembly</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">            val </span><span style="color: #FF7B72">:=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mload</span><span style="color: #C9D1D9">(bytePos)</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        val </span><span style="color: #FF7B72">&gt;&gt;=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">224</span><span style="color: #C9D1D9">; </span><span style="color: #8B949E">// Remove all but the first four bytes.</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> v0 </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> val </span><span style="color: #FF7B72">&gt;&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">24</span><span style="color: #C9D1D9">; </span><span style="color: #8B949E">// Get the first byte.</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (v0 </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> B11H) { </span><span style="color: #8B949E">// Check a 1 byte character.</span></span>
<span class="line"><span style="color: #C9D1D9">            len </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (B21L </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> v0 </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> v0 </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> B21H) { </span><span style="color: #8B949E">// Check a 2 byte character.</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> v1 </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (val </span><span style="color: #FF7B72">&amp;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x00FF0000</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">&gt;&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">16</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">require</span><span style="color: #C9D1D9">(DL </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> v1 </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> v1 </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> DH);</span></span>
<span class="line"><span style="color: #C9D1D9">            len </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">2</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (v0 </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> B31) { </span><span style="color: #8B949E">// Check a 3 byte character in the following three.</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #D2A8FF">validateWithNextDefault</span><span style="color: #C9D1D9">((val </span><span style="color: #FF7B72">&amp;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x00FFFF00</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">&gt;&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">8</span><span style="color: #C9D1D9">, B32L, B32H);</span></span>
<span class="line"><span style="color: #C9D1D9">            len </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">3</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (v0 </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> B51) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #D2A8FF">validateWithNextDefault</span><span style="color: #C9D1D9">((val </span><span style="color: #FF7B72">&amp;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x00FFFF00</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">&gt;&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">8</span><span style="color: #C9D1D9">, B52L, B52H);</span></span>
<span class="line"><span style="color: #C9D1D9">            len </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">3</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> ((B41L </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> v0 </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> v0 </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> B41H) </span><span style="color: #FF7B72">||</span><span style="color: #C9D1D9"> v0 </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> B61L </span><span style="color: #FF7B72">||</span><span style="color: #C9D1D9"> v0 </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> B61H) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #D2A8FF">validateWithNextDefault</span><span style="color: #C9D1D9">((val </span><span style="color: #FF7B72">&amp;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x00FFFF00</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">&gt;&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">8</span><span style="color: #C9D1D9">, DL, DH);</span></span>
<span class="line"><span style="color: #C9D1D9">            len </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">3</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (v0 </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> B71) { </span><span style="color: #8B949E">// Check a 4 byte character in the following three.</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #D2A8FF">validateWithNextTwoDefault</span><span style="color: #C9D1D9">(val </span><span style="color: #FF7B72">&amp;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x00FFFFFF</span><span style="color: #C9D1D9">, B72L, B72H);</span></span>
<span class="line"><span style="color: #C9D1D9">            len </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">4</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (B81L </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> v0 </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> v0 </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> B81H) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #D2A8FF">validateWithNextTwoDefault</span><span style="color: #C9D1D9">(val </span><span style="color: #FF7B72">&amp;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x00FFFFFF</span><span style="color: #C9D1D9">, DL, DH);</span></span>
<span class="line"><span style="color: #C9D1D9">            len </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">4</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (v0 </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> B91) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #D2A8FF">validateWithNextTwoDefault</span><span style="color: #C9D1D9">(val </span><span style="color: #FF7B72">&amp;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x00FFFFFF</span><span style="color: #C9D1D9">, B92L, B92H);</span></span>
<span class="line"><span style="color: #C9D1D9">            len </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">4</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> { </span><span style="color: #8B949E">// If we reach this point, the character is not valid UTF-8</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">revert</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">validateWithNextDefault</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">val</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">low</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">high</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">private</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">pure</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (val </span><span style="color: #FF7B72">&amp;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xFF00</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">&gt;&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">8</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">require</span><span style="color: #C9D1D9">(low </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> high);</span></span>
<span class="line"><span style="color: #C9D1D9">        b </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> val </span><span style="color: #FF7B72">&amp;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x00FF</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">require</span><span style="color: #C9D1D9">(DL </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> DH);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">validateWithNextTwoDefault</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">val</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">low</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">high</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">private</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">pure</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">uint</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (val </span><span style="color: #FF7B72">&amp;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0xFF0000</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">&gt;&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">16</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">require</span><span style="color: #C9D1D9">(low </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> high);</span></span>
<span class="line"><span style="color: #C9D1D9">        b </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (val </span><span style="color: #FF7B72">&amp;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x00FF00</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">&gt;&gt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">8</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">require</span><span style="color: #C9D1D9">(DL </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> DH);</span></span>
<span class="line"><span style="color: #C9D1D9">        b </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> val </span><span style="color: #FF7B72">&amp;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0x0000FF</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">require</span><span style="color: #C9D1D9">(DL </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">&amp;&amp;</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">&lt;=</span><span style="color: #C9D1D9"> DH);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>